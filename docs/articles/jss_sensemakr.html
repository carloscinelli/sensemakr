<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>\pkg{sensemakr}: Sensitivity Analysis Tools for OLS,\pkg{sensemakr}: Sensitivity Analysis Tools for OLS,\pkg{sensemakr}: Sensitivity Analysis Tools for OLS • sensemakr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="\pkg{sensemakr}: Sensitivity Analysis Tools for OLS,\pkg{sensemakr}: Sensitivity Analysis Tools for OLS,\pkg{sensemakr}: Sensitivity Analysis Tools for OLS">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158095434-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158095434-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sensemakr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/sensemakr.html">Get started</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chadhazlett/sensemakr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>true</h1>
                        <h4 class="author">Carlos Cinelli</h4>
            <address class="author_afil">
      University of California, Los Angeles<br><h4 class="author">Chad Hazlett</h4>
            <address class="author_afil">
      University of California, Los Angeles<br><small class="dont-index">Source: <a href="https://github.com/chadhazlett/sensemakr/blob/master/vignettes/jss_sensemakr.Rmd"><code>vignettes/jss_sensemakr.Rmd</code></a></small>
      <div class="hidden name"><code>jss_sensemakr.Rmd</code></div>

    </address>
</address>
</div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      This paper introduces the the  package  for assesing the sensitivity of regression estimates to unobserved confounding. The package provides a suite of tools for sensitivity analysis in regression models developed in <span class="citation">Cinelli and Hazlett (2019)</span>. These tools are based on the familiar omitted variable bias framework, and can be easily computed using only standard regression results. Furthermore, they do not require assumptions on the functional form of the treatment assignment mechanism nor on the distribution of the unobserved confounders, naturally handle multiple confounders, possibly acting non-linearly, and enable bounding of sensitivity parameters employing domain knowledge.
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Making causal claims about the effect of some variable (the ``treatment’’) on an outcome using observational data poses a perenial problem for researchers across disciplines. In the common setting where researchers “adjust for observables” using tools such as regression, claiming that the resulting estimate is unbiased for a causal quantity rely on untestable assumptions about the absence of unobserved confounders. Weaker claims, e.g. that the causal quantity has a particular sign, similarly require that unobserved confounding does not exceed a certain level. Sensitivity analyses aid in evaluating such claims, by equiping investigators with information about how sensitive a given result is to varying degrees of unobserved confounding, improving upon our ability to understand and transparently communicate results under confounding.</p>
<p>A variety of such approaches have been proposed, dating back to <span class="citation">Cornfield et al. (1959)</span>, with more recent contributions including <span class="citation">(Rosenbaum and Rubin 1983; Robins 1999; Frank 2000; Rosenbaum 2002; Imbens 2003; Brumback et al. 2004; Frank et al. 2008, 2013; Hosman, Hansen, and Holland 2010; Imai et al. 2010; Vanderweele and Arah 2011; Blackwell 2013; Carnegie, Harada, and Hill 2016; Dorie et al. 2016; Middleton et al. 2016; Oster 2017; Cinelli et al. 2019; Franks, D’Amour, and Feller 2019)</span> Yet, such sensitivity analyses remain underutilized. We argue that a number of factors contribute to this reluctant uptake. One is the complicated nature and strong assumptions many of these methods impose, sometimes involving restrictions on or even a complete description of the nature of the confounder. A second reason is that though users routinely report “regression tables” (or perhaps coefficient plots) to convey the results of a regression, until recently we have lacked “standard” quantities that can simply and correctly summarize sensitivity in the face of unobserved confounding. Third, and most fundamentally, connecting the results of a formal sensitivity analysis to a cogent argument about what types of confounders may exist in one’s research project is often difficult, particularly when there are no compelling arguments as to why the treatment assignment should be approximately “ignorable”, “exogeneous”, or “as-if random”. Further, some of the solutions offered by the literature can lead users to erroneous conclusions.</p>
<p>The  package implements a suite of tools proposed in <span class="citation">Cinelli and Hazlett (2019)</span> for assessing the sensitivity of a regression coefficient to the inclusion of omitted variables. This approach shows how the familiar “omitted variable bias” (OVB) framework can be extended to address these challenges in the linear regression setting. Notably, these tools do not require assumptions on the functional form of the treatment assignment mechanism nor on the distribution of the unobserved confounder, and can be used to assess the sensitivity to multiple confounders, whether they influence the treatment and outcome linearly or not.</p>
<!-- Carlos: I think the quick start ends up not being very useful, because we need to explain everything anyway... -->
<!-- ## Illustration -->
<!-- As a "quick-start" guide, we first show the basic functionality of the package in a simulated example. This functionality will suffice for most users most of the time. The basic workflow is as follows:  -->
<!-- 1) Fit a linear outcome model using `lm.out <- lm()`. This should have your treatment and (pre-treatment) covariates on the right hand side.    -->
<!-- 2) Create a sensemakr object, `sense.out <- sensemakr(lm.out)`, which contains useful sensitivity quantitites. -->
<!-- 3) Explore the results by use of `plot(sense.out)` and `summary(sense.out)`, or through direct calls to the lower-level functions these methods use. -->
<!-- To demonstrate, we first create a simulated dataset. Consider the following linear structural model with a treatment variable $D$, an outcome variable $Y$ and two "confounders" $X$ and $Z$. All disturbance variables $U$ are mutually independent. Note that, in reality, the treatment $D$ has no causal effect on the outcome $Y$.  -->
<!-- \begin{align} -->
<!-- Z &= U_{z}\\ -->
<!-- X &= U_{x}\\ -->
<!-- D &= X + Z + U_d\\ -->
<!-- Y &= X + Z + U_y -->
<!-- \end{align} -->
<!-- The code below creates a sample of size $n = 500$ from this data generating process. -->
<!-- ```{r} -->
<!-- set.seed(10) -->
<!-- n <- 500 -->
<!-- Z <- rnorm(n) -->
<!-- X <- rnorm(n) -->
<!-- D <- X + Z + rnorm(n, sd = 3) -->
<!-- Y <- X + Z + rnorm(n, sd = 3) -->
<!-- ``` -->
<!-- Suppose that an investigator is interested in estimating the causal effect of $D$ on $Y$, but unfortunately the confounder $Z$ is not observed. Despite this, the investigator proceeds with estimation, running a linear regression model adjusting for $X$ only. This results in the following estimates in Table \ref{tab:example}. -->
<!-- ```{r} -->
<!-- lm.model <- lm(Y ~ D + X) -->
<!-- ``` -->
<!-- ```{r, echo = FALSE, include = TRUE, results = 'asis'} -->
<!-- stargazer::stargazer(lm.model, header = FALSE,  -->
<!--                      keep = "D",  -->
<!--                      label = "tab:example",  -->
<!--                      title = "restricted OLS results") -->
<!-- ``` -->
<!-- The estimated coefficient for $D$ in the regression model adjusting for $X$ is statistically signficant and large relative to the scale of $D$. The investigator, however, knows that she has not measured all relevant confounders, and that the observed association between $Y$ and $D$ could be due to the omission of some variable $Z$. Further, to aid interpretation or even argue for bounds on confounding, she considers a working assumption that the omitted variable $Z$ is at least as strong as the observed variable $X$, meaning it explains at least as much residual variation in $D$ and $Y$ as $Z$ does.  -->
<!-- How would our estimate vary as we recognize or postulate different degrees of potential confounding? At what point would confounding become strong enough to substantially alter the conclusions of the study? And how can we compare the strength of confounding needed to alter our result to observed covariates to better understand what such confounding implies, or to bound the degree of confounding we think is possible? The \pkg{sensemakr} package provides tools to answer these types of questions. -->
<!-- <!-- Old version: How strong would $Z$ need to be to substantially alter the conclusions of the study? Is that strength plausible? Or, more precisely, how strong would $Z$ need to be relative to the observed covariate $X$? The \pkg{sensemakr} package provides tools to answer these types of questions.!-->
<p>–&gt;</p>
<!-- To begin, the investigator passes the estimated model to the function `sensemakr()`, along with the treatment of interest $D$ and optionally an indication of what observed covariates will be used for comparison or "benchmarking", -->
<!-- ```{r, message = FALSE} -->
<!-- library(sensemakr) -->
<!-- sense.model <- sensemakr(model = lm.model,   -->
<!--                          treatment = "D",  -->
<!--                          benchmark_covariates = "X",  -->
<!--                          kd = 1) -->
<!-- sense.model -->
<!-- ``` -->
<!-- The output contains values such as the partial variance in the outcome explained by the treatment, and the "robustness value". For example, the robustness value of 0.14 indicates that confounding explaining less than 14\% of both the treatment and outcome residual variance would not be sufficient to fully account for the estimate. We defer further explanation until below.  Further, full text output in plain English, describing the meaning of these parameters, is provided through `summary(sense.model)`. -->
<!-- The user may also be interested in a number of graphical illustrations of how the estimate varies under hypothesized confounding, including how it would be affected if confounding is "as strong as" the covariate $X$. For example, we can see contour plots of adjusted estimates for the t-statistic, -->
<!-- ```{r, include = FALSE} -->
<!-- cap.example <- "\\label{fig:example} Sensitivity contours of the t-value" -->
<!-- ## plot config -->
<!-- cex.lab = .7 -->
<!-- cex.label.text = .6 -->
<!-- cex.axis = .7 -->
<!-- labcex = .6 -->
<!-- ``` -->
<!-- ```{r, fig.cap= cap.example, fig.pos = "!h", message = FALSE} -->
<!-- plot(sense.model, sensitivity.of = "t-value") -->
<!-- ``` -->
<!-- where the point labeled `1xX` indicates the adjusted estimate as it would appear had confouding been as strong as $X$.  -->
</div>
<div id="sensitivity-analysis-in-an-omitted-variable-bias-framework" class="section level1">
<h1 class="hasAnchor">
<a href="#sensitivity-analysis-in-an-omitted-variable-bias-framework" class="anchor"></a>Sensitivity analysis in an omitted variable bias framework</h1>
<p>In this section, we briefly review the extension of the omitted variable bias (OVB) framework presented in <span class="citation">Cinelli and Hazlett (2019)</span>. This extension builds on the reparameterization of the OVB formula in terms of partial <span class="math inline">\(R^2\)</span> values, which allows</p>
<p>Readers that want to see these tools applied in practice, may skip this section.</p>
<!-- \textcolor{blue}{CJH: I wouldn't mention these yet -- would define bias and give two formulas then describe RV and partial R2yd.} The “robustness value” describes the minimum strength of association unobserved confounding would need to have, both with the treatment and with the outcome, to change the research conclusions. The partial $R^2$ of the treatment with the outcome shows how strongly confounders explaining all the residual outcome variation would have to be associated with the treatment to eliminate the estimated effect. Next, we offer graphical tools for elaborating on problematic confounders, examining the sensitivity of point estimates, t-values, as well as ``extreme scenarios'' !-->
<p>The starting point of the analysis is a linear regression model of an outcome <span class="math inline">\(Y\)</span> on a treatment <span class="math inline">\(D\)</span>, controlling for a set of covariates given by  <span class="math inline">\({\bf X}\)</span> and <span class="math inline">\(Z\)</span>, <span class="math display">\[\begin{align}
Y &amp;= \hat{\tau} D + {\bf X} \hat{{\bf \beta}} +  \hat{\gamma}Z + \hat{\epsilon}_{\text{full}}  \label{eq:fulleq}
\end{align}\]</span> where <span class="math inline">\(Y\)</span> is an <span class="math inline">\((n \times 1)\)</span> vector containing the outcome of interest for each of the <span class="math inline">\(n\)</span> observations and <span class="math inline">\(D\)</span> is an <span class="math inline">\((n \times 1)\)</span> treatment variable (which may be continuous or binary); <span class="math inline">\({\bf X}\)</span> is an <span class="math inline">\((n \times p)\)</span> matrix of  (pre-treatment) covariates including the constant; and <span class="math inline">\(Z\)</span> is a single <span class="math inline">\((n \times 1)\)</span>  covariate.</p>
<p>However, since <span class="math inline">\(Z\)</span> is unobserved, the feasible regression the investigator can estimate is the restricted model <span class="math display">\[\begin{align}
Y  &amp;= \hat{\tau}_{\text{res}} D + {\bf X} \hat{{\bf \beta}}_{\text{res}} + \hat{\epsilon}_{\text{res}}\label{eq:restrictedeq}
\end{align}\]</span> where <span class="math inline">\(\hat{\tau}_{\text{res}}\)</span>, <span class="math inline">\(\hat{{\bf \beta}}_{\text{res}}\)</span> are the coefficient estimates of the restricted OLS with only <span class="math inline">\(D\)</span> and <span class="math inline">\({\bf X}\)</span>,  <span class="math inline">\(Z\)</span>, and <span class="math inline">\(\hat{\epsilon}_{\text{res}}\)</span> its corresponding residual.</p>
<p>How does the observed estimate <span class="math inline">\(\hat{\tau}_{\text{res}}\)</span> compare to the desired estimate, <span class="math inline">\(\hat{\tau}\)</span>? Let us define as <span class="math inline">\(\widehat{\text{bias}}\)</span> the difference between these estimates, <span class="math inline">\(\widehat{\text{bias}}~:=~\hat{\tau}_{\text{\text{res}}}~-~\hat{\tau}\)</span>, where the hat, <span class="math inline">\(\widehat{(\cdot)}\)</span>, clarifies that this quantity is a difference between sample estimates, not the difference between the expectation of a sample estimate and a population value.</p>
<div id="traditional-ovb" class="section level3">
<h3 class="hasAnchor">
<a href="#traditional-ovb" class="anchor"></a>Traditional OVB</h3>
<!-- \textcolor{blue}{We can take this route -- FWL to show the classical OVB in the coefficient scale, then switch to R2. Or we can just assert the bias is given by one formula for the estimate and one for the SE. In the Colombia paper, we now do the latter, so its very quick. Here though I like what we have now and lean towards keeping it -- its quick enough that the improvement in understanding is worth it, I think.} !-->
<p>Using the Frisch-Waugh-Lovell (FWL) theorem () we can ``partial out’’ the observed covariates <span class="math inline">\({\bf X}\)</span> to give the familiar omitted variable bias (OVB) solution,</p>
<p><span class="math display">\[\begin{align}
\hat{\tau}_{\text{\text{res}}} &amp;= \frac{\text{cov}(D^{\perp {\bf X}}, ~Y^{\perp {\bf X}})}{\text{var}(D^{\perp {\bf X}})} \notag\\
            &amp;= \frac{\text{cov}(D^{\perp {\bf X}},~\hat{\tau} D^{\perp {\bf X}} + \hat{\gamma}Z^{\perp {\bf X}} )}{\text{var}(D^{\perp {\bf X}})} \notag\\
            &amp;= \hat{\tau} +  \hat{\gamma}\left(\frac{\text{cov}(D^{\perp {\bf X}},~Z^{\perp {\bf X}})}{\text{var}(D^{\perp {\bf X}})} \right) \notag\\
                &amp;= \hat{\tau} + \hat{\gamma}\hat{\delta}  \label{eq:biasdef}
\end{align}\]</span></p>
<p>where <span class="math inline">\(\text{cov}(\cdot)\)</span> and <span class="math inline">\(\text{var}(\cdot)\)</span> denote the  covariance and variance; <span class="math inline">\(Y^{\perp {\bf X}}\)</span>, <span class="math inline">\(D^{\perp {\bf X}}\)</span> and <span class="math inline">\(Z^{\perp {\bf X}}\)</span> are the variables <span class="math inline">\(Y\)</span>, <span class="math inline">\(D\)</span> and <span class="math inline">\(Z\)</span> after removing the components linearly explained by <span class="math inline">\({\bf X}\)</span> and we define <span class="math inline">\(\hat{\delta}~:=~\frac{\text{cov}(D^{\perp {\bf X}}, Z^{\perp {\bf X}})}{\text{var}(D^{\perp {\bf X}})}\)</span>. We then have <span class="math display">\[\begin{align}
\widehat{\text{bias}} =  \hat{\gamma}\hat{\delta}  \label{eq:deltagamma}
\end{align}\]</span></p>
</div>
<div id="reparameterizing-the-ovb-formula" class="section level3">
<h3 class="hasAnchor">
<a href="#reparameterizing-the-ovb-formula" class="anchor"></a>Reparameterizing the OVB formula</h3>
<p>Appealing again to the FWL theorem, we can expand Eq. </p>
<p><span class="math display">\[\begin{align}
\widehat{\text{bias}} &amp;=  \hat{\delta}\hat{\gamma}\notag\\
 &amp;= \left(\frac{\text{cov}(D^{\perp {\bf X}}, ~ Z^{\perp {\bf X}})}{\text{var}(D^{\perp {\bf X}})}\right) \left(\frac{\text{cov}(Y^{\perp {\bf X},D}, ~Z^{\perp {\bf X},D})}{\text{var}(Z^{\perp {\bf X},D})}\right) \notag\\
&amp;= \left(\frac{\text{cor}(D^{\perp {\bf X}}, ~ Z^{\perp {\bf X}})\text{sd}(Z^{\perp {\bf X}})}{\text{sd}(D^{\perp {\bf X}})}\right) \left(\frac{\text{cor}(Y^{\perp {\bf X},D}, ~Z^{\perp {\bf X},D})\text{sd}(Y^{\perp {\bf X}, D})}{\text{sd}(Z^{\perp {\bf X},D})}\right) \notag\\
&amp;=  \left(\frac{\text{cor}(Y^{\perp {\bf X}, D}, ~Z^{\perp {\bf X},D}) \text{cor}(D^{\perp {\bf X}}, ~ Z^{\perp {\bf X}})}{\frac{\text{sd}(Z^{\perp {\bf X}, D})}{\text{sd}(Z^{\perp {\bf X}})}} \right)  \left(\frac{\text{sd}(Y^{\perp {\bf X},D})}{ \text{sd}(D^{\perp {\bf X}}) } \right) \label{eq:biascor}
\end{align}\]</span></p>
<p>Noting that <span class="math inline">\(\text{cor}(Y^{\perp {\bf X},D},Z^{\perp {\bf X},D}) ^ 2 = R^2_{Y\sim Z|{\bf X},D}\)</span>, that <span class="math inline">\(\text{cor}(Z^{\perp {\bf X}}, ~D^{\perp {\bf X}})^2 = R^2_{D\sim Z | {\bf X}}\)</span>, and that <span class="math inline">\(\frac{\text{var}(Z^{\perp {\bf X}, D})}{\text{var}(Z^{\perp {\bf X}})} = 1-R^2_{Z \sim D | {\bf X}} = 1-R^2_{D \sim Z | {\bf X}}\)</span>, we can rewrite Eq. to rely only partial <span class="math inline">\(R^2\)</span> measures of association rather than raw regression coefficients,</p>
<p><span class="math display">\[\begin{align}
|\widehat{\text{bias}}| &amp;= \sqrt{\frac{ R^2_{Y\sim Z|D, {\bf X}}~ R^2_{D\sim Z | {\bf X}}}{1 - R^2_{D\sim Z | {\bf X}}}} \left(\frac{\text{sd}(Y^{\perp {\bf X}, D})}{ \text{sd}(D^{\perp {\bf X}}) }\right). \label{eq:r2bias}
\end{align}\]</span></p>
<p>Investigators may be interested in how confounders alter inference as well, so we also examine the standard error. Let <span class="math inline">\(\text{df}\)</span> denote the model degrees of freedom (for the restricted regression actually run). Noting that</p>
<p><span class="math display">\[\begin{align}
\text{se}(\hat{\tau}_{\text{res}}) &amp;= \frac{\text{sd}(Y^{\perp {\bf X},D})}{\text{sd}(D^{\perp {\bf X}})} \sqrt{\frac{1}{\text{df}}} \label{eq:seres} \\  
\text{se}(\hat{\tau}) &amp;= \frac{\text{sd}(Y^{\perp {\bf X},D, Z})}{\text{sd}(D^{\perp {\bf X}, Z})} \sqrt{\frac{1}{\text{df} - 1}}, \label{eq:sefull}
\end{align}\]</span></p>
<p>whose ratio is <span class="math display">\[\begin{align}
\frac{\text{se}(\hat{\tau})}{\text{se}(\hat{\tau}_{\text{res}})} &amp;= \left(\frac{\text{sd}(Y^{\perp {\bf X}, D, Z})}{\text{sd}(Y^{\perp {\bf X},D})}  \right) 
                                                                 \left(\frac{\text{sd}(D^{\perp {\bf X}})}{\text{sd}(D^{\perp {\bf X}, Z})}  \right) 
                                                                 \sqrt{\frac{\text{df}}{\text{df}-1}},
\end{align}\]</span></p>
<p>we obtain the expression for the standard error of <span class="math inline">\(\hat{\tau}\)</span></p>
<p><span class="math display">\[\begin{align}
\text{se}(\hat{\tau})  = \text{se}(\hat{\tau}_{\text{res}}) \sqrt{\frac{1 - R^2_{Y\sim Z|D, {\bf X}}}{1 - R^2_{D\sim Z | {\bf X}}} \left(\frac{\text{df}}{\text{df}-1}\right)}.  \label{eq:r2se} 
\end{align}\]</span></p>
<p>Moreover, with this we can further see the bias as <span class="math display">\[\begin{align}
|\widehat{\text{bias}}| &amp;= \text{se}(\hat{\tau}_{\text{res}}) \sqrt{\frac{ R^2_{Y\sim Z|D, {\bf X}}~ R^2_{D\sim Z | {\bf X}}}{1 - R^2_{D\sim Z | {\bf X}}} (\text{df})}. \label{eq:r2bias2}
\end{align}\]</span></p>
</div>
<div id="making-sense-of-the-partial-r2-parameterization" class="section level3">
<h3 class="hasAnchor">
<a href="#making-sense-of-the-partial-r2-parameterization" class="anchor"></a>Making sense of the partial R2 parameterization</h3>
<p>In the partial <span class="math inline">\(R^2\)</span> parameterization, the relative bias, <span class="math inline">\(\left| \frac{\widehat{\text{bias}}}{\hat{\tau}_{\text{res}}}\right|\)</span>, has a simple form: <span class="math display">\[\begin{align}
\text{relative bias}  =
\frac{\overbrace{|R_{Y\sim Z|D, {\bf X}} \times f_{D\sim Z|{\bf X}}|}^\textrm{bias factor}}{\underbrace{|f_{Y\sim D|{\bf X}}|}_\textrm{partial f of D with Y}} =
\frac{\text{BF}}{|f_{Y\sim D|{\bf X}}|}. \label{eq:bf}
\end{align}\]</span></p>
<p>where <span class="math inline">\(f_{D\sim Z|{\bf X}}\)</span> is the partial Cohen’s <span class="math inline">\(f\)</span>.</p>
<p>How the confounder affects the variance has a straightforward interpretation as well. The relative change in the variance, <span class="math inline">\(\frac{\text{var}(\hat{\tau})}{\text{var}(\hat{\tau}_{\text{res}})}\)</span>, can be decomposed into three components,</p>
<p><span class="math display">\[\begin{align}
\text{relative change in variance}   &amp;=  
\overbrace{\left(1 - R^2_{Y\sim Z|D, {\bf X}}\right)}^\textrm{VRF} 
\underbrace{\left(\frac{ 1}{ 1 - R^2_{D\sim Z | {\bf X}}}\right)}_\textrm{VIF}
\overbrace{\left(\frac{\text{df}}{\text{df}-1}\right)}^\textrm{change in df} \notag\\
&amp;= \text{VRF} \times \text{VIF} \times \text{change in df}.\label{eq:relvar}
\end{align}\]</span></p>
</div>
<div id="bounds-on-the-strength-of-confounding" class="section level3">
<h3 class="hasAnchor">
<a href="#bounds-on-the-strength-of-confounding" class="anchor"></a>Bounds on the strength of confounding</h3>
<p><span class="citation">Cinelli and Hazlett (2019)</span> employs a bounding approach that uses observed covariates and their strength of association with the treatment and outcome as benchmarks against which to judge hypothetical degrees of confounding, or to argue for bounds on the permissible level of confounding. Assume first that <span class="math inline">\(Z \perp {\bf X}\)</span> or, equivalently, consider only the part of <span class="math inline">\(Z\)</span> not linearly explained by <span class="math inline">\({\bf X}\)</span>. Suppose a researcher is willing to assume that some covariate <span class="math inline">\(X_j\)</span> is particularly important to the treatment or outcome, and in fact that omitted variables cannot explain as much residual variance of <span class="math inline">\(D\)</span> or <span class="math inline">\(Y\)</span> as an observed covariate, <span class="math inline">\(X_j\)</span>. More flexibly, one can assert that confounding uniquely explains nor more than <span class="math inline">\(k_D\)</span> times as much of the treatment as does <span class="math inline">\(X_j\)</span> of the treatment, and no more than <span class="math inline">\(k_Y\)</span> as much of the outcome. Formally, this means <span class="math display">\[\begin{align}
k_D := \frac{R^2_{D\sim Z|{\bf X}_{-j}}}{R^2_{D\sim X_{j}|{\bf X}_{-j}} },  \qquad k_Y := \frac{R^2_{Y \sim Z |{\bf X}_{-j},D}}{R^2_{Y \sim X_{j} |{\bf X}_{-j},D}}.
\end{align}\]</span> Where <span class="math inline">\({\bf X}_{-j}\)</span> represents the vector of covariates <span class="math inline">\({\bf X}\)</span> excluding <span class="math inline">\(X_{j}\)</span>. That is, <span class="math inline">\(k_D\)</span> indexes how much variance of the treatment the confounder explains relative to how much <span class="math inline">\(X_j\)</span> explains (after controlling for the remaining covariates). Ffor example, if the researcher believes the omission of <span class="math inline">\(X_j\)</span> would result in a larger mean squared error of the treatment assignment regression than the omission of <span class="math inline">\(Z\)</span>, this equals the claim <span class="math inline">\(k_D \leq 1\)</span>. The same reasoning applies to <span class="math inline">\(k_Y\)</span>.</p>
<p>Given parameters <span class="math inline">\(k_D\)</span> and <span class="math inline">\(k_Y\)</span>, we can rewrite the strength of the confounders as, <span class="math display">\[\begin{align}
R^2_{D\sim Z|{\bf X}} = k_D f^2_{D\sim X_{j}|{\bf X}{-j}}, \qquad R^2_{Y\sim Z|D, {\bf X}} \leq \eta^2 f^2_{Y \sim X_j|{\bf X}_{-j},D} \label{eq:bounds}
\end{align}\]</span></p>
<p>where <span class="math inline">\(\eta\)</span> is a scalar which depends on <span class="math inline">\(k_Y\)</span>, <span class="math inline">\(k_D\)</span> and <span class="math inline">\(R^2_{D\sim X_{j}|{\bf X}{-j}}\)</span>,</p>
<p>These equations allow us to investigate the maximum bias possible due to confounding at most ``k times’’ as strong as a particular covariate <span class="math inline">\(X_j\)</span>.</p>
</div>
<div id="sensitivity-statistics-for-routine-reporting" class="section level2">
<h2 class="hasAnchor">
<a href="#sensitivity-statistics-for-routine-reporting" class="anchor"></a>Sensitivity statistics for routine reporting</h2>
<p>As the formulas above determine the bias (or adjusted values) of the estimate and the standard error for any given degree of confounding, they can be used in numerous ways to explore the sensitivity of a result. Contour plots, which we demonstrate below, allow us to visualize the entire range of results that would be obtained as we vary both sensitivity parameters. However, <span class="citation">Cinelli and Hazlett (2019)</span> propose several summary statistics that can more easily and readily convey the sensitivity of a results in the face of unobserved confounding and can be added to regression tables without having to convey an entire contour plot.</p>
<div id="the-partial-r2-of-the-treatment-with-the-outcome" class="section level3">
<h3 class="hasAnchor">
<a href="#the-partial-r2-of-the-treatment-with-the-outcome" class="anchor"></a>The partial R2 of the treatment with the outcome</h3>
<p>Consider the following question: ``if an extreme confounder explained all the residual variance of the outcome, how strongly associated with the treatment would it need to be in order to eliminate the estimated effect?’’ As it happens, the answer is precisely the <span class="math inline">\(R^2_{Y\sim D|{\bf X}}\)</span>.</p>
<p>Specifically, a confounder explaining  residual variance of the outcome implies <span class="math inline">\(R_{Y\sim Z|D, {\bf X}}~=~1\)</span>. By Equation , to bring the estimated effect down to zero (relative~bias = 1), this means <span class="math inline">\(|f_{D\sim Z|{\bf X}}|\)</span> needs to equal <span class="math inline">\(|f_{Y\sim D|{\bf X}}|\)</span>, which implies <span class="math inline">\(R^2_{D\sim Z|{\bf X}}~=~R^2_{Y\sim D|{\bf X}}\)</span>. Thus, <span class="math inline">\(R^2_{Y\sim D|{\bf X}}\)</span> is not only the determinant of the robustness of the treatment effect coefficient, but can also be interpreted as the result of an ``extreme scenario’’ sensitivity analysis.</p>
</div>
<div id="the-robustness-value" class="section level3">
<h3 class="hasAnchor">
<a href="#the-robustness-value" class="anchor"></a>The Robustness Value</h3>
<p>Let <span class="math inline">\(|t^*_{\alpha, \text{df}-1}|\)</span> denote the t-value threshold for a t-test with significance level of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\text{df}-1\)</span> degrees of freedom, and define <span class="math inline">\(f^*_{\alpha, \text{df} - 1} := |t^*_{\alpha, \text{df}-1}|/\sqrt{\text{df} -1}\)</span>. Now construct an adjusted <span class="math inline">\(f_{q, \alpha}\)</span>, accounting for both the proportion of reduction <span class="math inline">\(q\)</span> of the point estimate and the boundary below which statistical significance is lost at the level of <span class="math inline">\(\alpha\)</span>. First, define <span class="math inline">\(f_q = q|f_{Y\sim D | {\bf X}}|\)</span>. Then construct <span class="math display">\[\begin{align}
f_{q, \alpha} := f_q - f^*_{\alpha,\text{df} - 1}
\end{align}\]</span> If <span class="math inline">\(f_{q, \alpha} &lt; 0\)</span>, then the robustness value is zero. If <span class="math inline">\(f_{q, \alpha} &gt; 0\)</span>, then a confounder with a partial <span class="math inline">\(R^2\)</span> of, <span class="math display">\[\begin{align}
RV_{q, \alpha} = \frac{1}{2}\left(\sqrt{f_{q, \alpha}^4 + 4f_{q, \alpha}^2} - f_{q, \alpha}^2\right), \label{eq:rvt_main}
\end{align}\]</span></p>
<p>both with the treatment and with the outcome is sufficiently strong to make the adjusted t-test not reject the null hypothesis <span class="math inline">\(H_0: \tau = (1-q)|\hat{\tau}_{\text{res}}|\)</span> at the <span class="math inline">\(\alpha\)</span> level (or, equivalently, to make the adjusted <span class="math inline">\(1-\alpha\)</span> confidence interval include <span class="math inline">\((1-q)|\hat{\tau}_{\text{res}}|\)</span>). When <span class="math inline">\(RV_{q, \alpha} &gt; 1 - 1/f^2_{q}\)</span> then, as with the <span class="math inline">\(RV_q\)</span>, we can conclude that no confounder with both associations lower than <span class="math inline">\(RV_{q, \alpha}\)</span> is able to overturn the conclusion of such a test. In the rare cases when , then setting<br><span class="math display">\[
RV_{q, \alpha} = (f_{q}^2 - f^{*2}_{\alpha,\text{df} - 1})/(1+f^2_{q})
\]</span></p>
<p>restores the property that no confounder weaker on both associations would change the conclusion.</p>
</div>
</div>
</div>
<div id="an-illustration-of-the-basic-functionality-violence-in-darfur" class="section level1">
<h1 class="hasAnchor">
<a href="#an-illustration-of-the-basic-functionality-violence-in-darfur" class="anchor"></a>An illustration of the basic functionality: violence in Darfur</h1>
<p>Given that sensitivity analysis requires contextual knowledge to be properly interpreted, we illustrate the basic functionality of the package with a real example. Here we reproduce the results found in Section 5 of <a href="https://rss.onlinelibrary.wiley.com/doi/full/10.1111/rssb.12348">Cinelli and Hazlett (2020)</a>, which estimates the effects of exposure to violence on attitudes towards peace, in Darfur. Further details about this application and the data can be found in <a href="">Hazlett (2019)</a> and <a href="https://rss.onlinelibrary.wiley.com/doi/full/10.1111/rssb.12348">Cinelli and Hazlett (2020)</a>.</p>
<div id="the-data-and-research-question" class="section level3">
<h3 class="hasAnchor">
<a href="#the-data-and-research-question" class="anchor"></a>The data and research question</h3>
<p>During 2003 and 2004, the Darfurian government promoted a horrific violence campaign against civilians, killing an estimated two hundred thousand people. In this application, we are interested in learning how being directly harmed changed individual attitudes towards peace. On average, did direct exposure to this violence make individuals more likely to ask for revenge, or, due to wearieness, ask for peace?</p>
<p>The <code>sensemakr</code> package comes with an example dataset drawn from a survey on attitudes of Darfurian refugees in eastern Chad, regarding this unfortunate episode (Hazlett, 2019). The data can be loaded with the command <code><a href="https://rdrr.io/r/utils/data.html">data("darfur")</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># loads package</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sensemakr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># loads data</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"darfur"</span>)</a></code></pre></div>
<p>The “treatment” variable of interest is <code>directlyharmed</code>, which indicates whether the individual was physically injured during attacks on villages in Darfur, between 2003 and 2004. The main outcome of interest is <code>peacefactor</code>, an index measure of pro-peace attitudes. Other covariates in the data include: <code>village</code> (a factor variable indicating the original village of the respondent), <code>female</code> (a binary indicator of gender), <code>age</code>, <code>herder_dar</code> (whether they were a herder in Darfur), <code>farmer_dar</code> (whether they were a farmer in Darfur), and <code>past_voted</code> (whether they report having voted in an earlier election, prior to the conflict). For further details, see <code><a href="../reference/darfur.html">?darfur</a></code>.</p>
<p>Violence against civilians included aerial bombardments by the government as well as assaults by the <em>Janjaweed</em>, a pro-government militia. While some villages were selected for more exposure to violence, within village violence was largely indiscriminate. The bombing could not be finely targetted, and the <em>Janjaweed</em> had little information about civilians which to attack, with one major exception: women were targeted for sexual assault.</p>
<p>Given these considerations, a researcher may argue that adjusting for <code>village</code> and <code>female</code> is sufficient for control of confounding, and run the following linear regression model (in which other pre-treatment covariates, although not necessary for identification, are also included):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># runs regression model</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">darfur.model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(peacefactor <span class="op">~</span><span class="st"> </span>directlyharmed  <span class="op">+</span><span class="st"> </span>village <span class="op">+</span><span class="st">  </span>female <span class="op">+</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">                     </span>age <span class="op">+</span><span class="st"> </span>farmer_dar <span class="op">+</span><span class="st"> </span>herder_dar <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">                     </span>pastvoted <span class="op">+</span><span class="st"> </span>hhsize_darfur, </a>
<a class="sourceLine" id="cb2-5" data-line-number="5">                   <span class="dt">data =</span> darfur)</a></code></pre></div>
<p>This regression model results in the following estimates:</p>
% Table created by stargazer v.5.2.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu % Date and time: Mon, Feb 17, 2020 - 15:24:15

<p>That is, we find that, those exposed to violence were on average, more pro-peace.</p>
</div>
<div id="the-threat-of-unobserved-confounders" class="section level3">
<h3 class="hasAnchor">
<a href="#the-threat-of-unobserved-confounders" class="anchor"></a>The threat of unobserved confounders</h3>
<p>The previous estimate hinges on the assumption of <em>no unobserved confounders</em>. Not all investigators, however, may agree with this story.</p>
<p>For example, one may argue that, athough the bombing was crude, bombs were still more likely to hit the center of the village, and those in the center have already different attitudes towards peace. One may also argue that the <em>Janjaweed</em> could have some idea of the wealth of individuals and target those, or that individuals with certain previous political attitudes might have exposed themselves to danger more often. To complicate things, all these factors could be operating non-linearly, such as for instance, with interactions.</p>
<p>This suggest that, instead of the previous linear model ( <code>darfur.model</code> ), we should have run the model below,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">darfur.complete.model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(peacefactor <span class="op">~</span><span class="st"> </span>directlyharmed  <span class="op">+</span><span class="st"> </span>village <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">                              </span>female <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>farmer_dar <span class="op">+</span><span class="st"> </span>herder_dar <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">                              </span>pastvoted <span class="op">+</span><span class="st"> </span>hhsize_darfur <span class="op">+</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">                              </span>center<span class="op">*</span>wealth<span class="op">*</span>political_attitudes, </a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                            <span class="dt">data =</span> darfur)</a></code></pre></div>
<p>Where here <code>center*wealth*political_attitudes</code> is the <code>R</code> formula for including <em>fully interacted</em> terms for these three variables. But trying to fit the model <code>darfur.complete.model</code> will result in error: none of the variables <code>center</code>, <code>wealth</code> or <code>political_attitudes</code> were measured. Thus, this begs the question: how strong would these unobserved confounders (or <em>every</em> reamaining unobserved confounders) need to be to change our previous conclusions? Or, more precisely, how do the inferences regarding the coefficient of <code>directlyharmed</code> differ between the model we can actually fit <code>darfur.model</code> and the model we <em>wished</em> we could have fit <code>darfur.complete.model</code>?</p>
<p>Additionally, we have domain knowledge regarding the main determinants of exposure to violence, such as the special role of gender in targetting. This knowledge may be used to limit the strength of unobserved confounding. For instance, even if variables such as <code>wealth</code> remained as confounders, one could argue that it is unreasonable to expect that they explain more of the variation of exposure to violence than gender. How can we leverage claims regarding the relative importance of the variable <code>female</code> to bound the plausible strength of unobserved variables? We show next how to answer those questions using <code>sensemakr</code>.</p>
</div>
<div id="sensitivity-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#sensitivity-analysis" class="anchor"></a>Sensitivity Analysis</h2>
<p>The main function of the package is <code><a href="../reference/sensemakr.html">sensemakr()</a></code>. This function performs the most common sensitivity analyses, which can be then be explored with the print, summary and plot methods (see details in <code><a href="../reference/print.sensemakr.html">?print.sensemakr</a></code> and <code><a href="../reference/plot.sensemakr.html">?plot.sensemakr</a></code>). We begin the analysis by applying sensemakr to the original regression model, <code>darfur.model</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># runs sensemakr for sensitivity analysis</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># in the darfur example</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">darfur.sensitivity &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensemakr.html">sensemakr</a></span>(<span class="dt">model =</span> darfur.model, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                                <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                                <span class="dt">benchmark_covariates =</span> <span class="st">"female"</span>,</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                                <span class="dt">kd =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                                <span class="dt">ky =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">                                <span class="dt">q =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">                                <span class="dt">alpha =</span> <span class="fl">0.05</span>, </a>
<a class="sourceLine" id="cb4-10" data-line-number="10">                                <span class="dt">reduce =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The arguments here are:</p>
<ul>
<li><p><strong>model</strong>: the <code>lm</code> object with the outcome regression. In our case, <code>darfur.model</code>.</p></li>
<li><p><strong>treatment</strong>: the name of the treatment variable. In our case, <code>"directlyharmed"</code>.</p></li>
<li><p><strong>benchmark_covariates</strong>: the names of covariates that will be used to bound the plausible strength of the unobserved confounders. Here, we put <code>"female"</code>, given that we know it was one the main determinants of exposure to violence, and it is also a strong determinant of attitudes towards peace.</p></li>
<li><p><strong>kd</strong> and <strong>ky</strong>: these arguments parameterize how many times stronger the confounder is related to the treatment ( <code>kd</code> ) and to the outcome ( <code>ky</code> ) in comparison to the observed benchmark covariate ( <code>female</code> ). In our example, this means we want to investigate the maximum strength of a confounder once, twice, or three times as strong as female (in explaining treatment and outcome variation). Default for <code>ky</code> is to be the same as <code>kd</code>.</p></li>
<li><p><strong>q</strong>: what percent change the original effect estimate would be deemed problematic? Here 1 means a reduction of 100% of the current effect estimate, that is, a true effect of zero would be deemed problematic. Default is 1.</p></li>
<li><p><strong>alpha</strong>: significance level of interest for making statistical inferences. Default is 0.05.</p></li>
<li><p><strong>reduce</strong>: should we consider confounders acting towards <em>increasing</em> or <em>reducing</em> the absolute value of the estimate? The default is <code>reduce = TRUE</code>, which means we are considering confounders pull the estimate towards (or through) zero.</p></li>
</ul>
<p>Using the default arguments, one can simplify the previous call to:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">darfur.sensitivity &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensemakr.html">sensemakr</a></span>(<span class="dt">model =</span> darfur.model, </a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                                <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                                <span class="dt">benchmark_covariates =</span> <span class="st">"female"</span>,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                                <span class="dt">kd =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<p>We can now explore the sensitivity analysis results.</p>
<div id="minimal-sensitivity-reporting" class="section level3">
<h3 class="hasAnchor">
<a href="#minimal-sensitivity-reporting" class="anchor"></a>Minimal sensitivity reporting</h3>
<p>The print method of <code>sensemakr</code> provides a quick review of the original (unadjusted) estimate along with three summary sensitivity statistics suited for <em>routine reporting</em>: the partial R2 of the treatment with the outcome, the robustnuess value (RV) required to reduce the estimate entirely to zero (i.e. <span class="math inline">\(q=1\)</span>), and the RV beyond which the estimate would no longer be statistically distinguishable from zero at the 0.05 level (<span class="math inline">\(q=1\)</span>, <span class="math inline">\(\alpha=0.05\)</span>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">darfur.sensitivity</a></code></pre></div>
<pre><code>## Sensitivity Analysis to Unobserved Confounding
## 
## Model Formula: peacefactor ~ directlyharmed + village + female + age + farmer_dar + 
##     herder_dar + pastvoted + hhsize_darfur
## 
## Unadjusted Estimates of ' directlyharmed ':
##   Coef. estimate: 0.09732 
##   Standard Error: 0.02326 
##   t-value: 4.18445 
## 
## Sensitivity Statistics:
##   Partial R2 of treatment with outcome: 0.02187 
##   Robustness Value, q = 1 : 0.13878 
##   Robustness Value, q = 1 alpha = 0.05 : 0.07626 
## 
## For more information, check summary.</code></pre>
<p>The package also provides a function that creates a latex or html table with these results, as shown below (for the html table, simply change the argument to <code>format = "html"</code>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/print.sensemakr.html">ovb_minimal_reporting</a></span>(darfur.sensitivity, <span class="dt">format =</span> <span class="st">"latex"</span>)</a></code></pre></div>

<p>These three sensitivity statistics provide a <em>minimal reporting</em> for sensitivity analysis. More precisely:</p>
<ul>
<li><p>The robustness value for bringing the point estimate of <code>directlyharmed</code> exactly to zero (<span class="math inline">\(RV_{q=1}\)</span>) is 13.9% . This means that unobserved confounders that explain 13.9% of the residual variance <em>both</em> of the treatment and of the outcome are sufficient to explain away all the observed effect. On the other hand, unobserved confounders that <em>do not</em> explain 13.9% of the residual variance <em>both</em> of the treatment and of the outcome are not sufficiently strong to do so.</p></li>
<li><p>The robustness value for testing the null hypothesis that the coefficient of <code>directlyharmed</code> is zero <span class="math inline">\((RV_{q =1, \alpha = 0.05})\)</span> falls to 7.6%. This means that unobserved confounders that explain 7.6% of the residual variance <em>both</em> of the treatment and of the outcome are sufficient to bring the lower bound of the confidence interval to zero (at the chosen significance level of 5%). On the other hand, unobserved confounders that <em>do not</em> explain 7.6% of the residual variance <em>both</em> of the treatment and of the outcome are not sufficiently strong to do so.</p></li>
<li><p>Finally, the partial <span class="math inline">\(R^2\)</span> of <code>directlyharmed</code> with <code>peacefactor</code> means that, in an <em>extreme scenario</em>, in which we assume that unobserved confounders explain <em>all</em> of the left out variance of the outcome, these unobserved confounders would need to explain at least 2.2% of the residual variance of the treatment to fully explain away the observed effect.</p></li>
</ul>
<p>These are useful quantities that summarize <em>what you need to know</em> in order to safely rule out confounders that are deemed to be problematic. Interpreting these values requires domain knowledge about the data generating process. Therefore, we encourage researchers to argue about what are plausible bounds on the maximum explanatory power that unobserved confounders could have in a given application.</p>
<p>Sometimes researchers may have a hard time making judgments regarding the <em>absolute strength</em> of a confounder, but may have grounds to make <em>relative claims</em>, for instance, by arguing that unobserved confounders are likely not multiple times stronger than a certain observed covariate. In our application, this is indeed the case. One could argue that, given the nature of the attacks, it is hard to imagine that unobserved confounding could explain much more of targetting than what was explained by the observed variable <code>female</code>. The lower corner of the table, thus, provides bounds on confounding as strong as female, <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span> = 12.5%, and <span class="math inline">\(R^2_{D\sim Z| {\bf X} }\)</span> = 0.9%. Since both of those are below the RV, the table reveals that confounders as strong as <code>female</code> are not sufficient to explain away the observed estimate. Moreover, since the bound on <span class="math inline">\(R^2_{D\sim Z| {\bf X} }\)</span> is below the partial <span class="math inline">\(R^2\)</span> of the treatment with the outcome, <span class="math inline">\(R^2_{Y \sim D |{\bf X}}\)</span>, the table also reveals an extreme confounder explaining all residual variation of the outcome, and as strongly associated with the treatment as <code>female</code> also cannot do so.</p>
<p>All these results are exact for a single unobserved confounder, and conservative for multiple confounders, possibly acting non-linearly. Finally, the summary method for <code>sensemakr</code> provides an extensive report with verbal descriptions of the results, similar to the explanation we have given above. For further details, please refer to <a href="https://rss.onlinelibrary.wiley.com/doi/full/10.1111/rssb.12348">Cinelli and Hazlett (2020)</a>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(darfur.sensitivity)</a></code></pre></div>
</div>
<div id="sensitivity-contour-plots-of-point-estimates-and-t-values" class="section level3">
<h3 class="hasAnchor">
<a href="#sensitivity-contour-plots-of-point-estimates-and-t-values" class="anchor"></a>Sensitivity contour plots of point estimates and t-values</h3>
<p>The previous sensitivity table provides a good summary of how robust the current estimate is to unobserved confounding. However, researchers may be willing to refine their analysis by visually exploring the whole range of possible estimates that confounders with different strengths could cause, while placing different bounds on the plausible strength of confounding based on different assumptions on how they compare to observed covariates. For these, one can use the plot method for <code>sensemakr</code>.</p>
<p>As contour plots for the point estimate are the default, we start by examining those.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(darfur.sensitivity)</a></code></pre></div>
<p><img src="jss_sensemakr_files/figure-html/unnamed-chunk-11-1.png" width="250px" height="250px" style="display: block; margin: auto;"></p>
<p>The horizontal axis shows the hypothetical residual share of variation of the treatment that unobserved confouding explains, <span class="math inline">\(R^2_{D\sim Z| {\bf X} }\)</span>. The vertical axis shows the hypothetical partial <span class="math inline">\(R^2\)</span> of unobserved confouding with the outcome, <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span>. The contours show what would be the estimate for <code>directlyharmed</code> that one would have obtained in the full regression model including unobserved confounders with such hypothetical strengths. Note the plot is parameterized in way that hurts our preferred hypothesis, by pulling the estimate towards zero—the direction of the bias was set in the argument <code>reduce = TRUE</code> of <code><a href="../reference/sensemakr.html">sensemakr()</a></code>.</p>
<p>The bounds on the strength of confouding, determined by the parameter <code>kd = 1:3</code> in the call for <code><a href="../reference/sensemakr.html">sensemakr()</a></code>, are also shown in the plot. Note that the plot reveals that the direction of the effect (positive) is robust to confounding once, twice or even three times as strong as the observed covariate <code>female</code>, although in this last case the magnitude of the effect is reduced to a third of the original estimate.</p>
<p>We now examine the sensitivity of the <em>t-value</em> for testing the null hypothesis of zero effect. For this, it suffices to change the option <code>sensitivity.of = "t-value"</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(darfur.sensitivity, <span class="dt">sensitivity.of =</span> <span class="st">"t-value"</span>)</a></code></pre></div>
<p><img src="jss_sensemakr_files/figure-html/unnamed-chunk-12-1.png" width="250px" height="250px" style="display: block; margin: auto;"></p>
<p>The plot revelas that, at the 5% significance level, the null hypothesis of zero effect would still be rejected given confounders once or twice as strong as <code>female</code>. However, differently from the exact point-estimate, accounting for sampling uncertainty now means that the null hypothesis of zero effect <em>would not</em> be rejected with the inclusion of a confounder three times as strong as <code>female</code>.</p>
</div>
<div id="sensitivity-plots-of-extreme-scenarios" class="section level3">
<h3 class="hasAnchor">
<a href="#sensitivity-plots-of-extreme-scenarios" class="anchor"></a>Sensitivity plots of extreme scenarios</h3>
<p>Sometimes researches may be better equipped to make plausibility judgments about the strength of determinants of the treatment assignment mechanism, and have less knowledge about the determinantes of the outcome. In those cases, <em>extreme scenarios</em> sensitivity plots may be an option. For this plot, user should choose the option <code>type = extreme</code>. Here one assumes confounding explains <strong>all</strong> or a large fraction of the residual variance of the outcome, and examine how the point estimate is affected under different hypothetical strenghts of the association of the confounder with the treatment.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(darfur.sensitivity, <span class="dt">type =</span> <span class="st">"extreme"</span>)</a></code></pre></div>
<p><img src="jss_sensemakr_files/figure-html/unnamed-chunk-13-1.png" width="250px" height="250px" style="display: block; margin: auto;"></p>
<p>The default option for the extreme scenarios is <code>r2yz.dx = c(1, .75, .5)</code>, which sets the association of confounders with outcome to <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span>=100%, <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span>=75% and <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span>=50%. The bounds on the strength of association of a confounder once, twice or three times as strongly associated with the treatment as <code>female</code> are shown as red ticks in the horizonal axis. As the plot shows, even in the most extreme case of <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span>=100%, confounders would need to be more than twice as strongly associated with the treatment to fully explain away the point estimate. Moving to the scenarios <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span>=75% and <span class="math inline">\(R^2_{Y\sim Z| {\bf X}, D}\)</span>=50%, confounders would need to be more than three times as strongly associated with the treatment to fully explain away the point estimate.</p>
</div>
</div>
<div id="a-disciplined-discussion-about-confounding" class="section level2">
<h2 class="hasAnchor">
<a href="#a-disciplined-discussion-about-confounding" class="anchor"></a>A disciplined discussion about confounding</h2>
<p>Having gone through the basic functionality of the package, here we recall some caveats on intepretation that applies to any sensitivity analyses.</p>
<p>The results computed by <code><a href="../reference/sensemakr.html">sensemakr()</a></code> tell us what we need to be prepared to believe, in order to maintain the claim originally made: that exposure to violence, on average, had a large positive effect in attitudes towards peace, in Darfur 2003-2004. In particular, the results of the sensitivity analysis performed here show that, to explain all the observed estimated effect, even in a worst case scenario where the unobserved confounder explains all residual variation of the outcome, this unobserved confounder would need to be at least more than twice as strongly associated with the treatment as the covariate <code>female</code>. This is a <em>true quantitative statement</em> that describes the strength of confounding needed to overturn the research conclusions.</p>
<p>The analysis, however, says nothing about whether such a confounder does or does not exist. What it does is to <em>discipline the discussion</em> regarding the causal interpretation of the effect estimate:</p>
<ol style="list-style-type: decimal">
<li><p>A causal interpretation of the estimate may be defended by articulating that a confounder with such strength is unlikely. For instance, one could argue that, given the way injuries (the “treatment”) occurred, the scope for targeting particular types of individuals was quite limited; aircraft dropped makeshift and unguided bombs and other objects over villages, and militia raided without concern for who they are targeting—the only known major exception to this was targeting gender, which is one of the most visually apparent characteristics of an individual, and was one of the main factors of targetting due to sexual assaults.</p></li>
<li><p>Likewise, similar grounds are required to persuasively dismiss a causal interpretation of the estimate. There are standards of (relative) strength that hypothesized unobserved confounders need to meet in order to be problematic. For instance, a skeptic has to articulate (using domain knowledge) why a confounder that explains at least more than twice of the variation of the treatment assignment than the covariate Female is plausible. Otherwise, that confounder cannot logically account for all the observed association, even in an extreme scenario.</p></li>
</ol>
<p>That is, robustness to confouding is claimed to the extent one agrees with the arguments in 1 (which rely on domain knowledge about attacks in Darfur); and it can be deemed fragile insofar as alternative stories meeting the requirements in 2 can be made. Therefore, sensitivity analysis are not here to obviate discussions about confouding by following automatic procedures, but to estimulate a more displined, quantitative argument about confounding.</p>
</div>
</div>
<div id="customized-sensitivity-analyses" class="section level1">
<h1 class="hasAnchor">
<a href="#customized-sensitivity-analyses" class="anchor"></a>Customized sensitivity analyses</h1>
<p>The basic functionality demonstrated int he previous section will likely suffice for most users, most of the time. Sometimes, however, more flexibility will be needed in a given project. When this happens, researchers may resort directly to other sensitivity functions of the package to customize their sensitivity analysis. Those functions can be found in the <code>reference</code> documentation, and we also provide some examples of those types of analyses next.</p>
<p>Users will most commonly call upon the main functions and related methods, i.e.  and the <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code>, <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, and <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> methods for it. The package also gives users access to lower-level functions in order to compute key sensitivity statistics directly. The  package is organized:</p>
<p>Users that want to perform more specific sensitivity analysis can use individual functions. These functions can divided in the following categories, according to their functionalities:</p>
<ul>
<li><p><em>functions for computing the bias, adjusted estimates and standard errors:</em> these comprise the functions <code><a href="../reference/adjusted_estimate.html">bias()</a></code>, <code><a href="../reference/adjusted_estimate.html">relative_bias()</a></code>, <code>bias_factor()</code>, <code><a href="../reference/adjusted_estimate.html">adjusted_estimate()</a></code>, <code><a href="../reference/adjusted_estimate.html">adjusted_se()</a></code>, <code><a href="../reference/adjusted_estimate.html">adjusted_t()</a></code> and <code><a href="../reference/adjusted_estimate.html">adjusted_partial_r2()</a></code>. These functions take as input the original (unadjested) quantity and a pair of sensitivity parameters (the partial <span class="math inline">\(R^2\)</span> of the omitted variable with the treatment and the outcome), and return the new adjusted quantity reflecting the omitted variable bias.</p></li>
<li><p><em>functions for computing sensitivity statistics</em>: these comprise the functions <code><a href="../reference/robustness_value.html">robustness_value()</a></code>, <code><a href="../reference/partial_r2.html">partial_r2()</a></code>, <code><a href="../reference/partial_r2.html">partial_f()</a></code>, <code><a href="../reference/partial_r2.html">partial_f2()</a></code> and <code><a href="../reference/sensitivity_stats.html">sensitivity_stats()</a></code>. These functions compute the sensitivity statistics proposed in <span class="citation">Cinelli and Hazlett (2019)</span>, such as the robustness value and the partial <span class="math inline">\(R^2\)</span> of the treatment with the outcome, which reveal how robust the regression estimate is to unobserved confounding.</p></li>
<li><p><em>bounding functions</em>: the function <code>ovb_bound()</code> computes bounds on the strength of confounding</p></li>
<li><p><em>plotting functions</em>:</p></li>
</ul>
<div id="revisiting-darfur" class="section level2">
<h2 class="hasAnchor">
<a href="#revisiting-darfur" class="anchor"></a>Revisiting Darfur</h2>
<p>Show here how to reproduce with lower level functions:</p>
<div id="sensitivity-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#sensitivity-statistics" class="anchor"></a>Sensitivity statistics</h3>
<p>There are individual functions for each of the sensitivity statistics, , , and the . The robustness value and partial <span class="math inline">\(R^2\)</span> have been described above as key sensitivity statistics useful in standard reporting and with direct interpretations. The partial <span class="math inline">\(f\)</span> does not have as direct an interpretation but appears frequently in the mathematics described above as a sufficient statistic from which sensitivity analyses can be constructed.</p>
<p>These functions have both  and  numeric methods so that users may pass in an  object or call them using numerical values based from elsewhere.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># lm method</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="../reference/robustness_value.html">robustness_value</a></span>(<span class="dt">model =</span> darfur.model, <span class="dt">covariates =</span> <span class="st">"directlyharmed"</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##      0.1387764 
## Parameters: q = 1</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../reference/partial_r2.html">partial_r2</a></span>(<span class="dt">model =</span> darfur.model, <span class="dt">covariates =</span> <span class="st">"directlyharmed"</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##     0.02187309</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="../reference/partial_r2.html">partial_f</a></span>(<span class="dt">model =</span> darfur.model, <span class="dt">covariates =</span> <span class="st">"directlyharmed"</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##        0.14954</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># numeric method</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="../reference/robustness_value.html">robustness_value</a></span>(<span class="dt">t_statistic =</span> <span class="fl">4.18445</span>, <span class="dt">dof =</span> <span class="dv">783</span>)</a></code></pre></div>
<pre><code>## [1] 0.1387764
## Parameters: q = 1</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../reference/partial_r2.html">partial_r2</a></span>(<span class="dt">t_statistic =</span> <span class="fl">4.18445</span>, <span class="dt">dof =</span> <span class="dv">783</span>)</a></code></pre></div>
<pre><code>## [1] 0.02187309</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="../reference/partial_r2.html">partial_f</a></span>(<span class="dt">t_statistic =</span> <span class="fl">4.18445</span>, <span class="dt">dof =</span> <span class="dv">783</span>)</a></code></pre></div>
<pre><code>## [1] 0.14954</code></pre>
<p>We also provide the convenience function  to compute all three sensitivity statistics for a regression coefficient of interest. The function returns a .</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="../reference/sensitivity_stats.html">sensitivity_stats</a></span>(<span class="dt">model =</span> darfur.model, <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>, <span class="dt">alpha =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>##        treatment   estimate         se t_statistic     r2yd.x      rv_q
## 1 directlyharmed 0.09731582 0.02325654     4.18445 0.02187309 0.1387764
##        rv_qa     f2yd.x dof
## 1 0.07625797 0.02236222 783</code></pre>
</div>
<div id="bias-and-adjusted-quantities" class="section level3">
<h3 class="hasAnchor">
<a href="#bias-and-adjusted-quantities" class="anchor"></a>Bias and adjusted quantities</h3>
<p>Several functions are useful to determine biases or adjusted estimates given those biases for postulated degrees of confounding: , , ,  , . Suppose we postulate confounding able to explain 5% of residual variation in treatment and in the outcome. We can compute various biases and adjustments directly,</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw"><a href="../reference/adjusted_estimate.html">bias</a></span>(darfur.model, <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>, <span class="dt">r2dz.x =</span> <span class="fl">0.05</span>, <span class="dt">r2yz.dx =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##     0.03338368</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="../reference/adjusted_estimate.html">relative_bias</a></span>(darfur.model, <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>, <span class="dt">r2dz.x =</span> <span class="fl">0.05</span>, <span class="dt">r2yz.dx =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##      0.3430447</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="../reference/adjusted_estimate.html">adjusted_estimate</a></span>(darfur.model, <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>, <span class="dt">r2dz.x =</span> <span class="fl">0.05</span>, <span class="dt">r2yz.dx =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##     0.06393214</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw"><a href="../reference/adjusted_estimate.html">adjusted_estimate</a></span>(<span class="dt">estimate =</span> <span class="fl">0.09731582</span>, <span class="dt">se =</span> <span class="fl">0.02325654</span>,</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">                  <span class="dt">dof =</span> <span class="dv">783</span>, <span class="dt">r2dz.x =</span> <span class="fl">0.05</span>, <span class="dt">r2yz.dx =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## [1] 0.06393214</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="co">### Adjustment to SE</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="kw"><a href="../reference/adjusted_estimate.html">adjusted_se</a></span>(darfur.model, <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>, <span class="dt">r2dz.x =</span> <span class="fl">0.05</span>, <span class="dt">r2yz.dx =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##      0.0232714</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="co">### Adjusted t-value </span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="kw"><a href="../reference/adjusted_estimate.html">adjusted_t</a></span>(darfur.model, <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>, <span class="dt">r2dz.x =</span> <span class="fl">0.05</span>, <span class="dt">r2yz.dx =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## directlyharmed 
##       2.747241</code></pre>
</div>
<div id="bounds" class="section level3">
<h3 class="hasAnchor">
<a href="#bounds" class="anchor"></a>Bounds</h3>
</div>
<div id="plotting-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-functions" class="anchor"></a>Plotting functions</h3>
<p>Current default options for plots works best with plots width and height around 4 to 5 inches.</p>

<p>. These can be called directly and bounds/benchmarks can be added to them through additional calls. For example,</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co"># contour plot</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="kw"><a href="../reference/ovb_contour_plot.html">ovb_contour_plot</a></span>(<span class="dt">model =</span> darfur.model, </a>
<a class="sourceLine" id="cb39-3" data-line-number="3">                 <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>,</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">                 <span class="dt">benchmark_covariates =</span> <span class="st">"female"</span>,</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">                 <span class="dt">kd =</span> <span class="dv">2</span>, <span class="dt">nlevels =</span> <span class="dv">5</span>, <span class="dt">lim =</span> <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb39-6" data-line-number="6"></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="kw"><a href="../reference/add_bound_to_contour.html">add_bound_to_contour</a></span>(<span class="dt">r2dz.x =</span> <span class="fl">0.1</span>, </a>
<a class="sourceLine" id="cb39-8" data-line-number="8">                     <span class="dt">r2yz.dx =</span> <span class="fl">0.1</span>, </a>
<a class="sourceLine" id="cb39-9" data-line-number="9">                     <span class="dt">bound_value =</span> <span class="kw"><a href="../reference/adjusted_estimate.html">adjusted_estimate</a></span>(<span class="dt">model =</span> darfur.model,</a>
<a class="sourceLine" id="cb39-10" data-line-number="10">                                                     <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>, </a>
<a class="sourceLine" id="cb39-11" data-line-number="11">                                                     <span class="dt">r2dz.x =</span> <span class="fl">.1</span>, <span class="dt">r2yz.dx =</span> <span class="fl">.1</span>),</a>
<a class="sourceLine" id="cb39-12" data-line-number="12">                     <span class="dt">bound_label =</span> <span class="st">"Manual Bound"</span>)</a>
<a class="sourceLine" id="cb39-13" data-line-number="13"></a>
<a class="sourceLine" id="cb39-14" data-line-number="14"></a>
<a class="sourceLine" id="cb39-15" data-line-number="15"><span class="co"># add bound 3/1 times stronger than female</span></a>
<a class="sourceLine" id="cb39-16" data-line-number="16"><span class="kw"><a href="../reference/add_bound_to_contour.html">add_bound_to_contour</a></span>(<span class="dt">model =</span> darfur.model,</a>
<a class="sourceLine" id="cb39-17" data-line-number="17">                     <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>,</a>
<a class="sourceLine" id="cb39-18" data-line-number="18">                     <span class="dt">benchmark_covariates =</span> <span class="st">"female"</span>,</a>
<a class="sourceLine" id="cb39-19" data-line-number="19">                     <span class="dt">kd =</span> <span class="dv">3</span>, <span class="dt">ky =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb39-20" data-line-number="20"></a>
<a class="sourceLine" id="cb39-21" data-line-number="21"><span class="co"># add bound 50/2 times stronger than age</span></a>
<a class="sourceLine" id="cb39-22" data-line-number="22"><span class="kw"><a href="../reference/add_bound_to_contour.html">add_bound_to_contour</a></span>(<span class="dt">model =</span> darfur.model,</a>
<a class="sourceLine" id="cb39-23" data-line-number="23">                     <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>,</a>
<a class="sourceLine" id="cb39-24" data-line-number="24">                     <span class="dt">benchmark_covariates =</span> <span class="st">"age"</span>,</a>
<a class="sourceLine" id="cb39-25" data-line-number="25">                     <span class="dt">kd =</span> <span class="dv">50</span>, <span class="dt">ky =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="jss_sensemakr_files/figure-html/unnamed-chunk-17-1.png" width="250px" height="250px" style="display: block; margin: auto;"></p>

<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw"><a href="../reference/ovb_extreme_plot.html">ovb_extreme_plot</a></span>(<span class="dt">model =</span> darfur.model, </a>
<a class="sourceLine" id="cb40-2" data-line-number="2">                 <span class="dt">treatment =</span> <span class="st">"directlyharmed"</span>,</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">                 <span class="dt">benchmark_covariates =</span> <span class="st">"female"</span>,</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">                 <span class="dt">kd =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">                 <span class="dt">lim =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="jss_sensemakr_files/figure-html/unnamed-chunk-18-1.png" width="250px" height="250px" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="the-risks-of-informal-benchmarking" class="section level2">
<h2 class="hasAnchor">
<a href="#the-risks-of-informal-benchmarking" class="anchor"></a>The risks of Informal Benchmarking</h2>
<p>In this section, we show how to replicate the example in Section 6.1 of <a href="https://doi.org/10.1111/rssb.12348">Cinelli and Hazlett (2020)</a> using the R package <code>sensemakr</code>. This example is especially useful to illustrate how users can construct their own sensitivity contour plots with customized bounds, and it also shows the risks of informal benchmarking procedures that are still widespread in the sensitivity analysis literature (e.g., Imbens, 2003; Blackwell, 2013; Hosman et al. 2010, Dorie et al., 2016, Hong et al. 2018).</p>
<div id="background" class="section level3">
<h3 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h3>
<p>Section 4.4 of <a href="https://doi.org/10.1111/rssb.12348">Cinelli and Hazlett (2020)</a> shows how it is possible to bound the maximum strength of confounding given relative judgments on how the strength unobserved variables compares to the strength of observed variables. You can compute those bounds with the <code>sensemakr</code> package using the function <code><a href="../reference/ovb_bounds.html">ovb_bounds()</a></code></p>
<p>Prior work in sensitivity analysis—dating back at least to Imbens (2003), and followed by others (e.g, Hosman et al. 2010, Dorie et al., 2016, Hong et al. 2018)—has also proposed comparing observables with unobservables, but has done so by informally using statistics of observed variables to “calibrate intuitions” about sensitivity parameters concerning the unobserved variable. This practice, however, can have undesirable consequences as we show next.</p>
</div>
<div id="simulating-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-the-data" class="anchor"></a>Simulating the data</h3>
<p>Let us begin by simulating the data generating process used in our example. Consider a treatment variable <span class="math inline">\(D\)</span>, an outcome variable <span class="math inline">\(Y\)</span>, one observed confounder <span class="math inline">\(X\)</span>, and one <em>unobserved</em> confounder <span class="math inline">\(Z\)</span>. Again, all disturbance variables <span class="math inline">\(U\)</span> are mutually independent and note that, in reality, the treatment <span class="math inline">\(D\)</span> has <em>no causal effect</em> on the outcome <span class="math inline">\(Y\)</span>.</p>
<p><span class="math display">\[\begin{align}
Z &amp;= U_{z}\\
X &amp;= U_{x}\\
D &amp;= X + Z + U_d\\
Y &amp;= X + Z + U_y
\end{align}\]</span></p>
<p>Also note that, in this model: (i) the unobserved confounder <span class="math inline">\(Z\)</span> is independent of <span class="math inline">\(X\)</span>; and, (ii) the unobserved confounder <span class="math inline">\(Z\)</span> is <em>exactly like</em> <span class="math inline">\(X\)</span> in terms of its strength of association with the treatment and the outcome. The code below creates a sample of size 10,000 of this data generating process.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="co"># sets seed for reproducibility</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="co"># simulates data</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5">n &lt;-<span class="st"> </span><span class="fl">1e5</span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6">Z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n)</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">X &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n)</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">Z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(Z <span class="op">~</span><span class="st"> </span>X)) <span class="co"># makes sure that Z is ortogonal to X</span></a>
<a class="sourceLine" id="cb41-9" data-line-number="9">D &lt;-<span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Z <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n)</a>
<a class="sourceLine" id="cb41-10" data-line-number="10">Y &lt;-<span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Z <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n)</a></code></pre></div>
</div>
<div id="fitting-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-the-model" class="anchor"></a>Fitting the model</h3>
<p>In this example, the investigator does not observe the confounder <span class="math inline">\(Z\)</span>. Therefore, she is forced to fit the restricted linear model <span class="math inline">\(Y \sim D + X\)</span>, resulting in the following estimated values</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">model.ydx &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(Y <span class="op">~</span><span class="st"> </span>D <span class="op">+</span><span class="st"> </span>X) </a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model.ydx)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Y ~ D + X)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2889 -0.8314  0.0017  0.8287  5.2918 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.006058   0.003883   -1.56    0.119    
## D            0.501434   0.002745  182.69   &lt;2e-16 ***
## X            0.497381   0.004755  104.60   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.228 on 99997 degrees of freedom
## Multiple R-squared:  0.4998, Adjusted R-squared:  0.4998 
## F-statistic: 4.995e+04 on 2 and 99997 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Note we obtain a large and statistically significant coefficient estimate of the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> (<span class="math inline">\(0.5\)</span>). However, we know that the variable <span class="math inline">\(Z\)</span> is not observed, and there is the fear that this estimated effect is in fact due to the bias caused by <span class="math inline">\(Z\)</span>. On the other hand, let us suppose the investigator correctly know that: (i) <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span> have the same strength of association with <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span>; and, (ii) <span class="math inline">\(Z\)</span> is independent of <span class="math inline">\(X\)</span>. Can we leverage this information to undersand how much bias a confounder <span class="math inline">\(Z\)</span> “not unlike” <span class="math inline">\(X\)</span> could cause?</p>
</div>
<div id="informal-benchmarks" class="section level3">
<h3 class="hasAnchor">
<a href="#informal-benchmarks" class="anchor"></a>Informal benchmarks</h3>
<p>Computing the bias due to the omission of <span class="math inline">\(Z\)</span> requires two sensitivity parameters: its partial <span class="math inline">\(R^2\)</span> with the treatment <span class="math inline">\(D\)</span> and its partial <span class="math inline">\(R^2\)</span> with the outcome <span class="math inline">\(Y\)</span>. How could we go about computing the bias that a confounder <span class="math inline">\(Z\)</span> “not unlike <span class="math inline">\(X\)</span>” would cause?</p>
<p>Intuitively, it seems that we could take as reference the observed partial <span class="math inline">\(R^2\)</span> of <span class="math inline">\(X\)</span> with <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span>, and use those as the plausible values for the sensitivity parameters. That’s the essence of many informal benchmarking proposals. So llet us now compute those observed partial <span class="math inline">\(R^2\)</span> using the <code><a href="../reference/partial_r2.html">partial_r2()</a></code> function of <code>sensemakr</code>. For the partial <span class="math inline">\(R^2\)</span> of <span class="math inline">\(X\)</span> with the treatment, we also need to fit a treatment regression <span class="math inline">\(D \sim X\)</span> first.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="co"># loads sensemakr package</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sensemakr)</a>
<a class="sourceLine" id="cb44-3" data-line-number="3"></a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="co"># fits treatment regression</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5">model.dx &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(D <span class="op">~</span><span class="st"> </span>X)</a>
<a class="sourceLine" id="cb44-6" data-line-number="6"></a>
<a class="sourceLine" id="cb44-7" data-line-number="7"><span class="co"># computes observed partial R2 of X</span></a>
<a class="sourceLine" id="cb44-8" data-line-number="8">r2yx.d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partial_r2.html">partial_r2</a></span>(model.ydx, <span class="dt">covariates =</span> <span class="st">"X"</span>)</a>
<a class="sourceLine" id="cb44-9" data-line-number="9">r2dx   &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partial_r2.html">partial_r2</a></span>(model.dx, <span class="dt">covariates =</span> <span class="st">"X"</span>)</a></code></pre></div>
<p>Once both partial <span class="math inline">\(R^2\)</span> are computed, we can determine the implied adjusted estimate due to an unobserved confounder <span class="math inline">\(Z\)</span> using the <code><a href="../reference/adjusted_estimate.html">adjusted_estimate()</a></code> function.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">informal_adjusted_estimate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/adjusted_estimate.html">adjusted_estimate</a></span>(model.ydx, </a>
<a class="sourceLine" id="cb45-2" data-line-number="2">                                                <span class="dt">treatment =</span> <span class="st">"D"</span>, </a>
<a class="sourceLine" id="cb45-3" data-line-number="3">                                                <span class="dt">r2dz.x =</span> r2dx, </a>
<a class="sourceLine" id="cb45-4" data-line-number="4">                                                <span class="dt">r2yz.dx =</span> r2yx.d)</a></code></pre></div>
<p>We can now plot the sensitivity contours with <code><a href="../reference/ovb_contour_plot.html">ovb_contour_plot()</a></code> and add our informal benchmark with the numeric method of <code><a href="../reference/add_bound_to_contour.html">add_bound_to_contour()</a></code>. The arguments <code>label.bump.x</code> and <code>label.bump.y</code> of these functions allow adjusting the position of the bound label in the plot.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="co"># draws sensitivity contours</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="kw"><a href="../reference/ovb_contour_plot.html">ovb_contour_plot</a></span>(model.ydx,  </a>
<a class="sourceLine" id="cb46-3" data-line-number="3">                 <span class="dt">treatment =</span> <span class="st">"D"</span>, </a>
<a class="sourceLine" id="cb46-4" data-line-number="4">                 <span class="dt">lim =</span> <span class="fl">.6</span>)</a>
<a class="sourceLine" id="cb46-5" data-line-number="5"></a>
<a class="sourceLine" id="cb46-6" data-line-number="6"><span class="co"># adds informal benchmark </span></a>
<a class="sourceLine" id="cb46-7" data-line-number="7"><span class="kw"><a href="../reference/add_bound_to_contour.html">add_bound_to_contour</a></span>(<span class="dt">r2dz.x =</span> r2dx, </a>
<a class="sourceLine" id="cb46-8" data-line-number="8">                     <span class="dt">r2yz.dx =</span> r2yx.d, </a>
<a class="sourceLine" id="cb46-9" data-line-number="9">                     <span class="dt">bound_value =</span> informal_adjusted_estimate,</a>
<a class="sourceLine" id="cb46-10" data-line-number="10">                     <span class="dt">bound_label =</span> <span class="st">"Informal benchmark"</span>)</a></code></pre></div>
<p><img src="jss_sensemakr_files/figure-html/unnamed-chunk-23-1.png" width="250px" height="250px" style="display: block; margin: auto;"></p>
<p>As we can see, the results of the informal benchmark are different from what we expected. The informal benchmark point is still far away from zero, and this would lead an investigator to incorrectly conclude that an unobserved confounder <span class="math inline">\(Z\)</span> “not unlike <span class="math inline">\(X\)</span>” is not sufficient to explain away the observed effect. Moreover, this incorrect conclusion occurs despite <em>correctly</em> assuming that: (i) <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span> have the same strength of association with <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span>; and, (ii) <span class="math inline">\(Z\)</span> is independent of <span class="math inline">\(X\)</span>. Why does this happen?</p>
<p>As explained in Section 6.1 of <a href="https://doi.org/10.1111/rssb.12348">Cinelli and Hazlett (2020)</a>, there are two problems affecting informal benchmarks in this setting. First, we have to make an adjustment of baseline variance to be explained, since the sensitivity parameters consider the partial <span class="math inline">\(R^2\)</span> of <span class="math inline">\(Z\)</span> with the outcome, after taking into account what is already explained by <span class="math inline">\(X\)</span>. Second, consider the DAG of our structural model:</p>
<p><img src="collider.png" width="307" height="311" style="display: block; margin: auto;"></p>
<p>That is, although <span class="math inline">\(Z\)</span> is <em>marginally</em> independent of <span class="math inline">\(X\)</span>, note that <span class="math inline">\(Z\)</span> is not <em>conditionally</em> independent of <span class="math inline">\(X\)</span>, <em>given</em> <span class="math inline">\(D\)</span>, because <span class="math inline">\(D\)</span> is a <em>collider</em> (Pearl, 2009). This distorts the observed quantities of <span class="math inline">\(X\)</span> that are being used for benchmarking.</p>
</div>
<div id="formal-bounds" class="section level3">
<h3 class="hasAnchor">
<a href="#formal-bounds" class="anchor"></a>Formal bounds</h3>
<p>Given the above considerations, we do not recomment using informal benchmarks for sensitivity analysis. We now show how to compute formal bounds. In <code>sensemakr</code>, you can use the function <code><a href="../reference/ovb_bounds.html">ovb_bounds()</a></code>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="co"># compute formal bounds</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2">formal_bound &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ovb_bounds.html">ovb_bounds</a></span>(<span class="dt">model =</span> model.ydx, </a>
<a class="sourceLine" id="cb47-3" data-line-number="3">                           <span class="dt">treatment =</span> <span class="st">"D"</span>, </a>
<a class="sourceLine" id="cb47-4" data-line-number="4">                           <span class="dt">benchmark_covariates =</span> <span class="st">"X"</span>, </a>
<a class="sourceLine" id="cb47-5" data-line-number="5">                           <span class="dt">kd =</span> <span class="dv">1</span>, <span class="dt">ky =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>In this function you specify the linear model being used (<code>model.ydx</code>), the treatment of interst (<span class="math inline">\(D\)</span>), the observed variable used for benchmarking (<span class="math inline">\(X\)</span>), and how stronger <span class="math inline">\(Z\)</span> is in explaining treatment (<code>kd</code>) and outcome (<code>ky</code>) variation, as compared to the benchmark variable <span class="math inline">\(X\)</span>. We can now plot the proper bound against the informal benchmark.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="co"># contour plot</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="kw"><a href="../reference/ovb_contour_plot.html">ovb_contour_plot</a></span>(model.ydx,  </a>
<a class="sourceLine" id="cb48-3" data-line-number="3">                 <span class="dt">treatment =</span> <span class="st">"D"</span>,</a>
<a class="sourceLine" id="cb48-4" data-line-number="4">                 <span class="dt">lim =</span> <span class="fl">.6</span>)</a>
<a class="sourceLine" id="cb48-5" data-line-number="5"></a>
<a class="sourceLine" id="cb48-6" data-line-number="6"><span class="kw"><a href="../reference/add_bound_to_contour.html">add_bound_to_contour</a></span>(<span class="dt">r2dz.x =</span> r2dx, </a>
<a class="sourceLine" id="cb48-7" data-line-number="7">                     <span class="dt">r2yz.dx =</span> r2yx.d, </a>
<a class="sourceLine" id="cb48-8" data-line-number="8">                     <span class="dt">bound_value =</span> informal_adjusted_estimate,</a>
<a class="sourceLine" id="cb48-9" data-line-number="9">                     <span class="dt">bound_label =</span> <span class="st">"Informal benchmark"</span>)</a>
<a class="sourceLine" id="cb48-10" data-line-number="10"></a>
<a class="sourceLine" id="cb48-11" data-line-number="11"><span class="kw"><a href="../reference/add_bound_to_contour.html">add_bound_to_contour</a></span>(<span class="dt">bounds =</span> formal_bound,</a>
<a class="sourceLine" id="cb48-12" data-line-number="12">                     <span class="dt">bound_label =</span> <span class="st">"Proper bound"</span>)</a></code></pre></div>
<p><img src="jss_sensemakr_files/figure-html/unnamed-chunk-27-1.png" width="250px" height="250px" style="display: block; margin: auto;"></p>
<p>Note that, using the formal bounds, the researcher now reaches the correct conclusion that, an unobserved confounder <span class="math inline">\(Z\)</span> similar to <span class="math inline">\(X\)</span> is strong enough to explain away all the observed association. For further details, please see Sections 4.4 and 6.1 of <a href="https://doi.org/10.1111/rssb.12348">Cinelli and Hazlett (2020)</a>.</p>
</div>
</div>
</div>
<div id="stata-package" class="section level1">
<h1 class="hasAnchor">
<a href="#stata-package" class="anchor"></a>Stata Package</h1>
<p>Briefly reproduce Darfur in stata.</p>
</div>
<div id="final-remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#final-remarks" class="anchor"></a>Final Remarks</h1>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-blackwell2013selection">
<p>Blackwell, Matthew. 2013. “A Selection Bias Approach to Sensitivity Analysis for Causal Effects.” <em>Political Analysis</em> 22 (2). Oxford University Press: 169–82.</p>
</div>
<div id="ref-brumback2004sensitivity">
<p>Brumback, Babette A, Miguel A Hernán, Sebastien JPA Haneuse, and James M Robins. 2004. “Sensitivity Analyses for Unmeasured Confounding Assuming a Marginal Structural Model for Repeated Measures.” <em>Statistics in Medicine</em> 23 (5). Wiley Online Library: 749–67.</p>
</div>
<div id="ref-carnegie:jree2016">
<p>Carnegie, Nicole Bohme, Masataka Harada, and Jennifer L Hill. 2016. “Assessing Sensitivity to Unmeasured Confounding Using a Simulated Potential Confounder.” <em>Journal of Research on Educational Effectiveness</em> 9 (3). Taylor &amp; Francis: 395–420.</p>
</div>
<div id="ref-cinelli:jrssb2019">
<p>Cinelli, Carlos, and Chad Hazlett. 2019. “Making Sense of Sensitivity: Extending Omitted Variable Bias.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>. <a href="https://doi.org/10.1111/rssb.12348">https://doi.org/10.1111/rssb.12348</a>.</p>
</div>
<div id="ref-cinelli:icml2019">
<p>Cinelli, Carlos, Daniel Kumor, Bryant Chen, Judea Pearl, and Elias Bareinboim. 2019. “Sensitivity Analysis of Linear Structural Causal Models.” <em>International Conference on Machine Learning</em>.</p>
</div>
<div id="ref-cornfield1959smoking">
<p>Cornfield, Jerome, William Haenszel, E Cuyler Hammond, Abraham M Lilienfeld, Michael B Shimkin, and Ernst L Wynder. 1959. “Smoking and Lung Cancer: Recent Evidence and a Discussion of Some Questions.” <em>Journal of National Cancer Institute</em>, no. 23. Oxford University Press: 173–203.</p>
</div>
<div id="ref-dorie2016flexible">
<p>Dorie, Vincent, Masataka Harada, Nicole Bohme Carnegie, and Jennifer Hill. 2016. “A Flexible, Interpretable Framework for Assessing Sensitivity to Unmeasured Confounding.” <em>Statistics in Medicine</em> 35 (20). Wiley Online Library: 3453–70.</p>
</div>
<div id="ref-frank:smr2000">
<p>Frank, Kenneth A. 2000. “Impact of a Confounding Variable on a Regression Coefficient.” <em>Sociological Methods &amp; Research</em> 29 (2). Sage Publications, Inc.: 147–94.</p>
</div>
<div id="ref-frank2013would">
<p>Frank, Kenneth A, Spiro J Maroulis, Minh Q Duong, and Benjamin M Kelcey. 2013. “What Would It Take to Change an Inference? Using Rubin’s Causal Model to Interpret the Robustness of Causal Inferences.” <em>Educational Evaluation and Policy Analysis</em> 35 (4). SAGE Publications Sage CA: Los Angeles, CA: 437–60.</p>
</div>
<div id="ref-frank:eepa2008">
<p>Frank, Kenneth A, Gary Sykes, Dorothea Anagnostopoulos, Marisa Cannata, Linda Chard, Ann Krause, and Raven McCrory. 2008. “Does Nbpts Certification Affect the Number of Colleagues a Teacher Helps with Instructional Matters?” <em>Educational Evaluation and Policy Analysis</em> 30 (1). Sage Publications Sage CA: Thousand Oaks, CA: 3–30.</p>
</div>
<div id="ref-franks:jasa2019">
<p>Franks, Alex, Alex D’Amour, and Avi Feller. 2019. “Flexible Sensitivity Analysis for Observational Studies Without Observable Implications.” <em>Journal of the American Statistical Association</em>, nos. just-accepted. Taylor &amp; Francis: 1–38.</p>
</div>
<div id="ref-hosman2010sensitivity">
<p>Hosman, Carrie A, Ben B Hansen, and Paul W Holland. 2010. “The Sensitivity of Linear Regression Coefficients’ Confidence Limits to the Omission of a Confounder.” <em>The Annals of Applied Statistics</em>. JSTOR, 849–70.</p>
</div>
<div id="ref-imai2010identification">
<p>Imai, Kosuke, Luke Keele, Teppei Yamamoto, and others. 2010. “Identification, Inference and Sensitivity Analysis for Causal Mediation Effects.” <em>Statistical Science</em> 25 (1). Institute of Mathematical Statistics: 51–71.</p>
</div>
<div id="ref-imbens2003sensitivity">
<p>Imbens, Guido W. 2003. “Sensitivity to Exogeneity Assumptions in Program Evaluation.” <em>The American Economic Review</em> 93 (2). JSTOR: 126–32.</p>
</div>
<div id="ref-middleton2016bias">
<p>Middleton, Joel A, Marc A Scott, Ronli Diakow, and Jennifer L Hill. 2016. “Bias Amplification and Bias Unmasking.” <em>Political Analysis</em> 24 (3). Oxford University Press: 307–23.</p>
</div>
<div id="ref-oster:jbes2017">
<p>Oster, Emily. 2017. “Unobservable Selection and Coefficient Stability: Theory and Evidence.” <em>Journal of Business &amp; Economic Statistics</em>. Taylor &amp; Francis, 1–18.</p>
</div>
<div id="ref-robins1999association">
<p>Robins, James M. 1999. “Association, Causation, and Marginal Structural Models.” <em>Synthese</em> 121 (1). Springer: 151–79.</p>
</div>
<div id="ref-rosenbaum2002gamma">
<p>Rosenbaum, Paul R. 2002. “Observational Studies.” In <em>Observational Studies</em>, 1–17. Springer.</p>
</div>
<div id="ref-rosenbaum1983assessing">
<p>Rosenbaum, Paul R, and Donald B Rubin. 1983. “Assessing Sensitivity to an Unobserved Binary Covariate in an Observational Study with Binary Outcome.” <em>Journal of the Royal Statistical Society. Series B (Methodological)</em>. JSTOR, 212–18.</p>
</div>
<div id="ref-arah2011">
<p>Vanderweele, Tyler J., and Onyebuchi A. Arah. 2011. “Bias formulas for sensitivity analysis of unmeasured confounding for general outcomes, treatments, and confounders.” <em>Epidemiology (Cambridge, Mass.)</em> 22 (1): 42–52. <a href="https://doi.org/10.1097/ede.0b013e3181f74493">https://doi.org/10.1097/ede.0b013e3181f74493</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#sensitivity-analysis-in-an-omitted-variable-bias-framework">Sensitivity analysis in an omitted variable bias framework</a><ul class="nav nav-pills nav-stacked">
<li><a href="#sensitivity-statistics-for-routine-reporting">Sensitivity statistics for routine reporting</a></li>
      </ul>
</li>
      <li>
<a href="#an-illustration-of-the-basic-functionality-violence-in-darfur">An illustration of the basic functionality: violence in Darfur</a><ul class="nav nav-pills nav-stacked">
<li><a href="#sensitivity-analysis">Sensitivity Analysis</a></li>
      <li><a href="#a-disciplined-discussion-about-confounding">A disciplined discussion about confounding</a></li>
      </ul>
</li>
      <li>
<a href="#customized-sensitivity-analyses">Customized sensitivity analyses</a><ul class="nav nav-pills nav-stacked">
<li><a href="#revisiting-darfur">Revisiting Darfur</a></li>
      <li><a href="#the-risks-of-informal-benchmarking">The risks of Informal Benchmarking</a></li>
      </ul>
</li>
      <li><a href="#stata-package">Stata Package</a></li>
      <li><a href="#final-remarks">Final Remarks</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://carloscinelli.com">Carlos Cinelli</a>, <a href="https://chadhazlett.com">Chad Hazlett</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
